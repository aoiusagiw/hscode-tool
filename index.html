<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HS Code 申報要素助手</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&family=Noto+Sans+TC:wght@400;500&display=swap" rel="stylesheet">
    <style>
        /* --- 全局背景設定 --- */
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            width: 100vw;
            background-color: #f0f2f5; /* 柔和的淺灰背景 */
            font-family: 'Roboto', 'Noto Sans TC', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center; /* 垂直水平置中 */
        }

        /* --- 雙框容器 --- */
        .container {
            display: flex;
            width: 90%;
            max-width: 1400px; /* 限制最大寬度，避免在大螢幕太寬 */
            height: 80vh;      /* 佔視窗高度 80% */
            gap: 24px;         /* 兩個框之間的間距 */
        }

        /* --- 卡片共同樣式 (圓角 + 陰影) --- */
        .card {
            flex: 1;
            background: #ffffff;
            border-radius: 16px; /* 大圓角 */
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08); /* 漂亮的懸浮陰影 */
            display: flex;
            flex-direction: column;
            overflow: hidden; /* 確保內容不超出圓角 */
            border: 1px solid #fff; /* 微調邊框 */
            transition: transform 0.2s, box-shadow 0.2s;
        }

        /* 滑鼠移過去稍微浮起的互動感 (可選) */
        .card:hover {
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.12);
        }

        /* --- 卡片標題區 --- */
        .card-header {
            padding: 20px 30px;
            background: #ffffff;
            border-bottom: 1px solid #f0f0f0;
            font-size: 16px;
            font-weight: 500;
            color: #5f6368;
            letter-spacing: 0.5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* --- 左邊輸入框 (Textarea) --- */
        textarea {
            flex: 1;
            width: 100%;
            border: none;
            outline: none;
            resize: none;
            padding: 30px;
            font-size: 20px; /* 字體大一點 */
            line-height: 1.6;
            color: #202124;
            font-family: inherit;
            box-sizing: border-box;
            background: transparent;
        }
        textarea::placeholder {
            color: #bdc1c6;
        }

        /* --- 右邊輸出框 (Div) --- */
        #output {
            flex: 1;
            padding: 30px;
            font-size: 20px; /* 字體大一點 */
            line-height: 1.6;
            color: #202124;
            white-space: pre-wrap; /* 保持純文字換行 */
            overflow-y: auto;
            background: #fafafa; /* 右邊稍微灰一點點，區分輸出區 */
        }

        /* --- 複製按鈕 --- */
        .btn-copy {
            background: transparent;
            border: 1px solid #dadce0;
            color: #1a73e8;
            padding: 6px 16px;
            border-radius: 20px; /* 膠囊狀按鈕 */
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-copy:hover {
            background: #e8f0fe;
            border-color: #d2e3fc;
        }
        .btn-copy.copied {
            background: #e6f4ea;
            color: #137333;
            border-color: transparent;
        }

        /* --- 載入動畫 --- */
        .loading-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 10;
        }
        .spinner {
            width: 40px; height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #1a73e8;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    </style>
</head>
<body>

<div class="container">
    
    <div class="card">
        <div class="card-header">提供資料 (INPUT)</div>
        <textarea id="inputData" placeholder="請在此貼上貨物資料...&#10;&#10;例如：&#10;品名：碳鋼木螺釘&#10;材質：碳鋼&#10;用途：家具組裝"></textarea>
    </div>

    <div class="card" style="position:relative;"> <div class="card-header">
            <span>AI 歸類結果 (OUTPUT)</span>
            <button id="btnCopy" class="btn-copy" onclick="copyResult()">複製內容</button>
        </div>
        
        <div id="output">
            <span style="color:#bdc1c6;">等待輸入...</span>
        </div>

        <div id="loading" class="loading-overlay">
            <div class="spinner"></div>
            <div style="margin-top:20px; color:#5f6368; font-weight:500;">AI 正在分析中...</div>
        </div>
    </div>

</div>

<script>
    const inputArea = document.getElementById('inputData');
    const outputDiv = document.getElementById('output');
    const loading = document.getElementById('loading');
    const copyBtn = document.getElementById('btnCopy');

    // 自動執行邏輯：貼上後延遲 0.5 秒執行
    inputArea.addEventListener('paste', () => {
        setTimeout(() => {
            if(inputArea.value.trim().length > 1) analyze();
        }, 500);
    });

    async function analyze() {
        const input = inputArea.value;
        if (!input.trim()) return;

        loading.style.display = "flex";

        try {
            // ★★★ 您的 Worker 網址 (從您的圖1抄下來的) ★★★
            const workerUrl = "https://hscode-api.kabawang.workers.dev"; 
            
            const response = await fetch(workerUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ productInfo: input })
            });

            const data = await response.json();

            if (data.result) {
                // 直接顯示純文字
                outputDiv.innerText = data.result;
            } else {
                outputDiv.innerHTML = `<span style="color:red;">發生錯誤：${data.error || "未知錯誤"}</span>`;
            }
        } catch (e) {
            outputDiv.innerHTML = `<span style="color:red; font-weight:bold;">連線失敗！</span><br><br>請依照以下步驟檢查：<br>1. 回到阿里雲後台，點擊黃色框框的【開通服務】(這是最常見原因)。<br>2. 檢查網路狀態。<br><br>錯誤代碼：${e}`;
        } finally {
            loading.style.display = "none";
        }
    }

    function copyResult() {
        const text = outputDiv.innerText;
        if (!text || text.includes("等待輸入")) return;
        
        navigator.clipboard.writeText(text).then(() => {
            const originalText = copyBtn.innerText;
            copyBtn.innerText = "已複製！";
            copyBtn.classList.add('copied');
            setTimeout(() => {
                copyBtn.innerText = originalText;
                copyBtn.classList.remove('copied');
            }, 2000);
        });
    }
</script>

</body>
</html>
